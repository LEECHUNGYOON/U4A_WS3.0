<!DOCTYPE html>
<html>

<head>
    <title>U4A Workspace</title>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
    <style>
        html,
        body {
            margin: 0px;
            height: 100%;
        }
    </style>
</head>

<body>

    <iframe id="ws_serverframe" name="ws_frame" style="border:none;width:100%;height:100%;" allow="autoplay 'src';">
    </iframe>

    <audio id="u4aWsAudio" style="visibility: hidden;">
    </audio>

    <script src="../cordova.js"></script>

    <script>
        /************************************************************************
         * onError 관련 공통 로직
         ************************************************************************/
        var REMOTE = require('@electron/remote'),
            PATH = REMOTE.require('path'),
            DIALOG = REMOTE.require('electron').dialog,
            CURRWIN = REMOTE.getCurrentWindow(),
            APP = REMOTE.app,
            APPPATH = APP.getAppPath(),
            WSLOG = require(PATH.join(APPPATH, "ws10_20", "js", "ws_log.js"));

        // [R&D 전용 console.log]
        var zconsole = {};
        zconsole.APP = APP;

        // 오류 로그 감지
        WSLOG.start(REMOTE, console);

        // 무한 루프 오류 방지 flag
        var bIsError = false;

        /************************************************************************
         * critical 오류 팝업
         ************************************************************************/
        function showCriticalErrorDialog(sErrorMsg) {

            DIALOG.showMessageBox(CURRWIN, {
                title: "[Critical Error] - The system will be shut down.",
                message: sErrorMsg,
                type: "error"
            }).then(() => {

                CURRWIN.close();

                // APP.exit();

            });

        } // end of showCriticalErrorDialog    

        function onError(message, url, line, col, errorObj) {

            if (bIsError) {
                return;
            }

            bIsError = true;

            let sErrMsg = `${message}\n${url}, ${line}:${col}`;

            console.error(sErrMsg);

            // critical 오류이므로 창을 다 닫는다.
            showCriticalErrorDialog(sErrMsg);

        }

        function onunhandledrejection(event) {

            if (bIsError) {
                return;
            }

            bIsError = true;

            let sErrorMsg = "";
            if (event.reason) {
                sErrorMsg = event.reason.stack.toString();
            }

            if (sErrorMsg == "") {
                sErrorMsg = "critical Error!";
            }

            console.error(sErrorMsg);

            // critical 오류이므로 창을 다 닫는다.
            showCriticalErrorDialog(sErrorMsg);

        }

        window.removeEventListener("unhandledrejection", onunhandledrejection);
        window.addEventListener("unhandledrejection", onunhandledrejection);

        window.onerror = onError;
        document.onerror = onError;
    </script>

    <script src="ServerFrame.js"></script>
</body>

</html>













<!-- <!DOCTYPE html>
<html>

<head>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type"
          content="text/html;charset=utf-8" />
    <meta http-equiv="X-UA-Compatible"
          content="IE=Edge" />
    <title>U4A Workspace #ServerList</title>
    <meta charset="utf-8">
    <link rel="stylesheet"
          href="./css/serverInfo.css">
</head>

<body>
    <iframe id="ws_serverframe"
            name="ws_serverframe"
            style="border:none;width:100%;height:100%;"
            allowfullscreen>
    </iframe>

    
    <div id="u4a_main_load"
         class="u4a_loaders u4a_loadersInactive">
        <span class="u4a_loader u4a_loader-bars"> <span></span> </span> Loading...
    </div>
    

    <script src="../cordova.js"></script>
    <script src="ServerFrame.js"></script>
</body>

</html> -->